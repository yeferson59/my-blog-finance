---
// src/pages/post/[id].astro
import Layout from '@/layouts/Layout.astro';
import { CommentSection } from '@/components/CommentSection';
import { getCollection, render } from 'astro:content';
import { Image } from 'astro:assets';
const { id } = Astro.params;
const user = Astro.locals.user
const posts = await getCollection('blog')
const post = posts.find(post => post.slug === id)
if(!post) return
const authors = await getCollection('authors', ({slug}) => {
  return post.data.authors.filter(author => author.slug === slug)
})
const { Content } = await render(post)
---

<Layout title={post.data.title}>
  <article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-4" transition:name={post.data.title}>{post.data.title}</h1>
    <div class="mb-4 flex gap-2">
      <p class="text-gray-600 dark:text-gray-400">
        Por {
            authors.map(author => (
              author.data.name
            ))
          }
        |
      </p>
      <time datetime={post.data.date.toISOString()}>
        {post.data.date.toLocaleDateString()}
      </time>
    </div>
    <Image src={post.data.cover} alt={post.data.title} class="w-full rounded-md mb-4" transition:name={`img-${post.slug}`} />
    <div class="prose dark:prose-invert max-w-none">
      <Content />
    </div>
    <CommentSection client:load articleId={post.slug} user={user}/>
  </article>
</Layout>