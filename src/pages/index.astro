---
// src/pages/index.astro
import HeroSection from "@/components/HeroSection.astro";
import FeaturedArticles from "@/components/FeaturedArticles.astro";
import TechnologySection from "@/components/TechnologySection.astro";
import FinanceSection from "@/components/FinanceSection.astro";
import AllPostsSection from "@/components/AllPostsSection.astro";
import NewsletterSection from "@/components/NewsletterSection.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";
import type Post from "@/interfaces/post";
import fetchApi from "@/lib/strapi";

let allPosts: Post[] = [];

try {
  allPosts = await fetchApi<Post[]>({
    endpoint:
      "articles?fields[0]=title&fields[1]=description&fields[2]=pubDate&fields[3]=featured&fields[4]=slug&populate[cover][fields]=formats&populate[category][fields]=name,slug&pagination[limit]=6",
    wrappedByKey: "data",
    method: "GET",
  });
} catch (error) {
  console.error("Error al obtener los art√≠culos:", error);
}
Astro.response.headers.set(
  "Cache-Control",
  "public, max-age=3600, s-maxage=3600, stale-while-revalidate=86400"
);
---

<BaseLayout title="Inicio blog" imageUrl="">
  <HeroSection />
  <TechnologySection client:load posts={allPosts} />
  <FinanceSection client:load posts={allPosts} />
  <FeaturedArticles client:load allPosts={allPosts} />
  <AllPostsSection client:load posts={allPosts} />
  <NewsletterSection />
</BaseLayout>
